# News aggregator

### Описание
Это тестовый проект - агрегатор  новостей. Он периодически (раз в 5 минут по-умолчанию) 
запрашивает новости с сайтов или RSS и сохраняет в базу данных.
Для избежания дублирования в базе новостей используется сравнение по заголовку.

Стек: spring boot, spring data, postgres, gradle, junit 5

### Использование
Приложение имеет 2 REST-эндпоинта:
1. Запрос новостей: `GET /api/news?query=Туле`. Параметр query (не обязательный) фильтрует по подстроке в заголовке 

Пример ответа: 
```json
[
    {
        "title": "В Туле открылся новый госпиталь для приема туляков с коронавирусом",
        "description": "http://www.n71.ru/files/215565/p215566d275i180.png",
        "imageUrl": "Вчера, 22 мая, в Туле открылся новый госпиталь для приема коронавирусных больных. Стационар...",
        "link": "http://www.n71.ru/news/section195/show215565/"
    },
    {
        "title": "23 мая за порядком в Туле проследит дежурный сотрудник администрации",
        "description": "http://www.n71.ru/files/215563/p215564d275i180.jpg",
        "imageUrl": "По традиции, каждые выходные и праздничные дни, в Туле организовывается дежурство сотрудников...",
        "link": "http://www.n71.ru/news/section55/show215563/"
    }
]
```

2. Сохранение источника новостей: `POST /api/sources`

Описание полей тела:
1. **url** - обязательный. Ссылка на источник
2. **parseRule** - обязательный. Правила разбора данных
3. **sourceType** - обязательный. RSS или HTML (для RSS не указываются нижеследующие параметры)
4. **elementSelector** - обязательный для HTML. CSS-селектор для выбора всех элементов, которые относятся к новостям
5. **titleSelector** - обязательный для HTML. CSS-селектор для выбора заголовка (относительно элемента новости)
6. **descriptionSelector** - необязательный. CSS-селектор для выбора описания (относительно элемента новости)
7. **imageSelector** - необязательный. CSS-селектор для выбора изображения (относительно элемента новости). Извлекается src
8. **linkSelector** - необязательный. CSS-селектор для выбора ссылки (относительно элемента новости). Извлекается href

Примеры содержимого тела запроса: 
```json
{
	"url": "https://www.e1.ru/news/rdf/full.xml",
	"parseRule": {
		"sourceType": "RSS"
	}	
}
```
```json
{
	"url": "http://www.n71.ru/news",
	"parseRule": {
		"sourceType": "HTML",
        "elementSelector": ".news-column",
        "titleSelector": "h2 a", 
        "descriptionSelector": ".news-announce",
        "imageSelector": "img[src]",
        "linkSelector": "h2 a[href]"
	}	
}
```
